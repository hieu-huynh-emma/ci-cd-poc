<script>
    window.routes = {
        cart_add_url: '{{ routes.cart_add_url }}',
        cart_change_url: '{{ routes.cart_change_url }}',
        cart_update_url: '{{ routes.cart_update_url }}',
        cart_clear_url: '{{ routes.cart_clear_url }}',
        predictive_search_url: '{{ routes.predictive_search_url }}'
    };

    window.cartStrings = {
        error: `{{ 'sections.cart.cart_error' | t }}`,
        quantityError: `{{ 'sections.cart.cart_quantity_error_html' | t }}`
    }

    window.variantStrings = {
        addToCart: `{{ 'products.product.add_to_cart' | t }}`,
        soldOut: `{{ 'products.product.sold_out' | t }}`,
        unavailable: `{{ 'products.product.unavailable' | t }}`,
    }

    window.accessibilityStrings = {
        shareSuccess: `{{ 'general.share.success_message' | t }}`,
    }

</script>



{% if isOptimized == true %}
  <script is="delay-script" url="{{ 'helpers.js' | asset_url }}"></script>

  <script is="delay-script" url="{{ 'resource-coordinator.js' | asset_url }}"></script>
  <script is="delay-script" url="{{ 'custom-elements.js' | asset_url }}"></script>


    <script is="delay-script" url="{{ 'lazy-component.js' | asset_url }}"></script>
  <script is="delay-script" url="{{ 'loading-overlay.js' | asset_url }}"></script>
  <script is="delay-script" url="{{ 'countdown-timer.js' | asset_url }}"></script>
  <script is="delay-script" url="{{ 'star-rating.js' | asset_url }}"></script>
  <script is="delay-script" url="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script>

  <script is="delay-script" phase="interactive" url="{{ 'global.js' | asset_url }}"></script>
  <script is="delay-script" phase="interactive" url="{{ 'lazy.min.js' | file_url }}"></script>

  <script is="delay-script" phase="interactive" url="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>

  <script is="delay-script" phase="interactive" url="{{ 'custom-tabs.js' | asset_url }}"></script>

  <script is="delay-script" url="{{ 'layout-script.js' | asset_url }}"></script>
  <script>

      const ENV = {
          logo: "{{ 'emma-logo.svg' | asset_url }}",
          checkGreenIcon: "{{ 'icon-check-green.svg' | asset_url }}",
          checkGrayIcon: "{{ 'icon-check-gray.svg' | asset_url }}",
          cancelIcon: "{{ 'icon-cancel.svg' | asset_url }}",
      };

      hiddenProductGuard();

      function hiddenProductGuard() {
          const extend = /\/products\/extend-/;
          const freePillow = /\/products\/2-pack-pillow/;
          const url = new URL(window.location.href);
          if (!extend.test(url.pathname) && !freePillow.test(url.pathname)) return;

          // redirect user
          window.location.replace('/');
      }

  </script>

{% else %}
  {% render 'old-page-scripts' %}
{% endif %}

