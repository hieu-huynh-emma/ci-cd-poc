{% assign type = type | default: "drawer" %}

<cart-item
    :key="{{ item.key }}"
    :itemId="{{ item.id }}"
    :index="{{ item.index }}"
    :variantId="{{ item.id }}"
    :productId="{{ item.product_id }}"
    :originalPrice="{{ item.variant.compare_at_price }}"
    :quantity="{{ item.quantity }}"
>
    {% assign primary_product_handle = item.product.metafields.accentuate.configurable_product %}
    {% assign primary_product = all_products[primary_product_handle] %}

    <a class="cart-item-media" href="{{ item.url }}">
        {{ item.image | image_url: width: 120, height: 80 | image_tag }}
    </a>
    <div class="cart-item-details">
        <a href="{{ item.url }}" class="product__name paragraph-14 font-semibold">
            {% assign title = item.title | split: ' - ' %}
            <span>
              {% if item.product.metafields.accentuate.is_bundle_cross_sell and item.product.metafields.accentuate.bundle_show_composite_product_name %}
                  {{ primary_product.title }} + Accessory Bundle
              {% else %}
                  {{ item.product.metafields.accentuate.display_name | default: title[0] }}
              {% endif %}
            </span>

            {% if item.selling_plan_allocation %}
                <span class="ajaxcart__product-meta">
                {{ item.selling_plan_allocation.selling_plan.name }}
              </span>
            {% endif %}
        </a>


        <div class="cart-item-actions">
            {% if item.variant.title != "Default Title" %}
                <p class="text-sm">
                    {{ item.variant.title }}
                </p>
                {% comment %}<cart-variant-selector{% endcomment %}
                {% comment %}class="variant-selector{% if isGWP %} hidden{% endif %}"{% endcomment %}
                {% comment %}:key="{{ item.key }}"{% endcomment %}
                {% comment %}:value="{{ item.variant_id }}"{% endcomment %}
                {% comment %}:options="{{ item.product.variants | json | escape }}"{% endcomment %}
                {% comment %}:quantity="{{ item.quantity }}"{% endcomment %}
                {% comment %}>{% endcomment %}
                {% comment %}</cart-variant-selector>{% endcomment %}
            {% endif %}
            <quantity-adjuster
                :index="{{ item.index }}"
                :value="{{ item.quantity }}"
                :inventoryPolicy="{{ item.variant.inventory_policy }}"
                {% unless isAddonService %}:max="{{ item.variant.inventory_quantity }}"{% endunless %}
            ></quantity-adjuster>
        </div>

        {% if item.product.metafields.accentuate.cart_promotional_message %}
            <div class="cart-item-description">
                {{ item.product.metafields.accentuate.cart_promotional_message }}
            </div>
        {% endif %}

        {% if item.product.metafields.accentuate.is_bundle %}
            {% assign current_variant = item.variant %}
            {% assign bundle_item_metaobjects = current_variant.metafields.custom.bundle_items.value %}

            {% if item.product.metafields.accentuate.bundle_show_composite_message %}
                <div class="cart-item-description">
                  <span>
                     {% if item.product.metafields.accentuate.is_free_gift %}
                         Your mattress purchase includes
                     {% else %}
                         Your purchase includes our
                     {% endif %}
                  </span>


                    <span>
                  {{ primary_product.title }} mattress ({{ current_variant.title }})
                  {% if bundle_item_metaobjects.count == 1 %}and {% else %}, {% endif %}
                </span>


                    {% for bundle_item_metaobject in bundle_item_metaobjects %}
                        {% assign bundle_item_variant = bundle_item_metaobject.product.value %}
                        {% assign qty = bundle_item_metaobject.qty | default: 1 %}

                        <span>
				  {{ qty }} {{ bundle_item_variant.product.metafields.accentuate.display_name | default: bundle_item_variant.product.title }}{% if qty > 1 %}s{% endif %}
                            {% if bundle_item_variant.title != "Default Title" %}
                                ({{ bundle_item_variant.title }})
                            {% endif %}
					</span>

                        {% unless forloop.last %}
                            <span> {% if forloop.rindex0 == 1 %}and {% else %}, {% endif %}</span>
                        {% endunless %}
                    {% endfor %}
                </div>
            {% endif %}

        {% endif %}

    </div>

    <div class="cart-item-totals">
        <loading-overlay class="hidden"></loading-overlay>

        <cart-item-remove-button
            id="CartDrawer-Remove-{{ item.index | plus: 1 }}"
            :index="{{ item.index }}"
            aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}"
            class="{% if isAddonService %}hidden{% endif %}"
        >
            <tracked-button :trackId="Delete_cart_ver">{% render 'icon-remove' %}</tracked-button>
        </cart-item-remove-button>


        <div class="cart-pricing cart-pricing--row">
            {% if item.variant.compare_at_price > item.variant.price %}
                <p class="cart-pricing__price cart-pricing__price--original">
                    {{ item.variant.compare_at_price | times: item.quantity | money_without_trailing_zeros }}
                </p>
            {% endif %}

            <p
                class="cart-pricing__price{% if item.variant.compare_at_price > item.variant.price %} text-red{% endif %}"
            >
                {% if item.final_line_price > 0 %}
                    {{ item.final_line_price | money_without_trailing_zeros }}
                {% else %}
                    FREE
                {% endif %}
            </p>
        </div>
    </div>

    <div class="cart-item-properties">
    </div>
</cart-item>


