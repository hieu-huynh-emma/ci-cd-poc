<link rel="quickscript" loading="delayed" href="{{ 'product-collage.css' | asset_url }}">

<section abtasty-campaign-id="1296959"
         id="product-collage-section" data-section-id="{{ section.id }}" class="section-container">
    <div class="section-chassis">
        <div class="page-boundary">
            {% render 'section-header' %}
        </div>
        <div class="page-boundary--no-gutter">
            <div class="collage-gallery">
                {% for block in section.blocks %}
                    {% liquid
                        assign collection = block.settings.collection
                        assign bgc = block.settings.background_color
                    %}

                    <div class="collage-card{% if block.settings.is_block %} collage-card--block{% endif %}"
                         data-type="{{ block.type }}"
                         style="{% if bgc != blank %}background-color: {{ block.settings.background_color }}{% endif %}"
                    >

                        <div class="collage-container">
                            {% if block.settings.media == blank %}
                                <div
                                        class="collection-grid__item-overlay grid__image">{{ 'collection-1' | placeholder_svg_tag: 'placeholder-svg' }}</div>
                            {% else %}
                                {% case block.type %}
                                    {% when "image" %}
                                        {%- assign collection_image = blank -%}

                                        {% if block.settings.media %}
                                            {% assign collection_image = block.settings.media | image_url: width: 1440 %}
                                        {% elsif collection.metafields.accentuate.featured_image[0] %}
                                            {%- assign collection_image = collection.metafields.accentuate.featured_image[0].src -%}
                                        {% elsif collection.image %}
                                            {%- assign collection_image = collection.image | image_url: width: 1440 -%}
                                        {% elsif collection.products.first and collection.products.first.featured_media != empty %}
                                            {%- assign collection_image = collection.products.first.featured_media.preview_image | image_url: width: 1440 -%}
                                        {% endif %}

                                        <img class="lazyload card-photo"
                                             data-src="{{ collection_image }}"
                                             data-sizes="auto"
                                             data-parent-fit="cover"
                                        />
                                    {% when "video" %}
                                        {% assign media = block.settings.media %}
                                        {% assign poster = media | image_url: width: 550 | prepend: "https:" %}
                                        <video class="card-media lazy" playsinline autoplay loop muted
                                               poster="{{ poster }}">
                                            {% for source in media.sources %}
                                                <source
                                                        data-src="{{ source.url }}"
                                                        type="{{ source.mime_type }}">
                                            {% endfor %}
                                        </video>
                                {% endcase %}
                            {% endif %}

                            <tracked-button :trackId="{{ block.settings.trackId }}" href="{{ collection.url }}"
                                            class="card-content">
                                <p class="text-md md:text-xl font-semibold"
                                   style="color: {{ block.settings.text_color }}">{{ block.settings.heading }}</p>
                                {% comment %}<p class="uppercase font-semibold text-xs md:text-sm">{{ block.settings.subheading }}</p>{% endcomment %}
                            </tracked-button>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>


{% schema %}
{
  "name": "Product Collage (Revamp)",
  "blocks": [
    {
      "type": "image",
      "name": "Collage Image",
      "settings": [
        {
          "id": "heading",
          "type": "text",
          "label": "Heading"
        },
        {
          "id": "subheading",
          "type": "text",
          "label": "Subheading"
        },
        {
          "id": "media",
          "type": "image_picker",
          "label": "Item Image"
        },
        {
          "id": "collection",
          "type": "collection",
          "label": "Linked Product Collection"
        },
        {
          "id": "is_block",
          "type": "checkbox",
          "label": "Show full width block?"
        },
        {
          "id": "background_color",
          "type": "color",
          "label": "Background Color"
        },
        {
          "id": "text_color",
          "type": "color",
          "label": "Text Color",
          "default": "#ffffff"
        },
        {
          "id": "trackId",
          "type": "text",
          "label": "Tracking ID"
        }
      ]
    },
    {
      "type": "video",
      "name": "Collage Video",
      "settings": [
        {
          "id": "heading",
          "type": "text",
          "label": "Heading"
        },
        {
          "id": "subheading",
          "type": "text",
          "label": "Subheading"
        },
        {
          "id": "media",
          "type": "video",
          "label": "Video"
        },
        {
          "id": "collection",
          "type": "collection",
          "label": "Linked Product Collection"
        },
        {
          "id": "is_block",
          "type": "checkbox",
          "label": "Show full width block?"
        },
        {
          "id": "background_color",
          "type": "color",
          "label": "Background Color"
        },
        {
          "id": "text_color",
          "type": "color",
          "label": "Text Color",
          "default": "#ffffff"
        },
        {
          "id": "trackId",
          "type": "text",
          "label": "Tracking ID"
        }
      ]
    }
  ],
  "settings": [
    {
      "id": "heading",
      "type": "text",
      "label": "Heading",
      "default": "Emma's Advanced Sleep Range"
    },
    {
      "id": "heading_alignment",
      "type": "select",
      "label": "Heading Alignment",
      "options": [
        {
          "value": "start",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "end",
          "label": "Right"
        }
      ],
      "default": "start"
    },
    {
      "type": "select",
      "id": "container_spacing",
      "options": [
        {
          "value": "md",
          "label": "Medium (40px)"
        },
        {
          "value": "lg",
          "label": "Large (60px)"
        },
        {
          "value": "xl",
          "label": "XL (80px)"
        }
      ],
      "default": "md",
      "label": "Container Spacing"
    }
  ]
}
{% endschema %}
