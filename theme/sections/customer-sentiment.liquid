{% assign allReviews = section.blocks | where: "type", "review" %}
{% assign ctaBtn = section.blocks | where: "type", "cta-button" | first %}


<link rel="quickscript" loading="visibility" href="{{ 'customer-sentiment.css' | asset_url }}"/>

{% liquid

    assign trackId = "Truth_scroll"
    assign ctaTrackId = "See_reviews"

    if template == 'index'
        assign postfix = "HP"
    elsif template == "page.sale"
        assign postfix = "SP"
    elsif template contains "collection"
        assign postfix = "CP"
    else
        assign postfix = product.metafields.accentuate.track_postfix
    endif

    if postfix != blank
        assign trackId = trackId | append: "_" | append: postfix
        assign ctaTrackId = ctaTrackId | append: "_" | append: postfix
    endif
%}

<section abtasty-campaign-id="1296959"
         id="customer-sentiment-section" class="section-container spacing-sm">
    <div class="section-chassis page-boundary--left">
        {% render 'section-header' %}

        <div class="splide splide--borderless pagination-bar">
            {% include 'splide-arrows', trackId: trackId %}

            <div class="splide__track">
                <ul class="splide__list">
                    {% for block in allReviews %}

                        {% liquid
                            assign product = block.settings.product
                        %}

                        <li class="splide__slide">
                            <customer-review-card
                                    class="customer-review"
                                    :clampable="{{ enable_text_clamp | default: false }}"
                            >
                                <div class="customer-review__header">
                                    <a href="{{ product.url }}" class="underline">
                                        {{ product.title }}
                                    </a>
                                    {% render 'star-ratings' %}
                                </div>

                                <div class="customer-review__body">
                                    <p class="customer-review__title">
                                        {{ block.settings.title }}
                                    </p>

                                    <div class="customer-review__content">
                                        {% render 'rtf-viewer', content: block.settings.content %}
                                    </div>
                                </div>

                                <div class="reviewer">
                                    <p class="reviewer__name">{{ block.settings.author }}</p>
                                    {% comment %}<div class="reviewer__verified">{% endcomment %}
                                    {% comment %}<svg width="12" height="13" viewBox="0 0 12 13" fill="none"{% endcomment %}
                                    {% comment %}xmlns="http://www.w3.org/2000/svg">{% endcomment %}
                                    {% comment %}<path{% endcomment %}
                                    {% comment %}d="M7.986 11.2933C8.78212 11.5456 9.6525 11.333 10.2431 10.7424C10.8337 10.1517 11.046 9.28137 10.794 8.48525C11.535 8.1005 12 7.33512 12 6.5C12 5.66488 11.535 4.8995 10.794 4.51475C11.0464 3.71863 10.8337 2.84825 10.2431 2.25762C9.6525 1.667 8.78212 1.45475 7.986 1.70675C7.60125 0.965375 6.8355 0.5 6 0.5C5.1645 0.5 4.39875 0.965375 4.014 1.70675C3.21825 1.45512 2.34863 1.66737 1.758 2.25725C1.16738 2.84713 0.95475 3.71675 1.206 4.51288C0.465 4.89762 0 5.663 0 6.49813C0 7.33325 0.465 8.09862 1.206 8.48337C0.9525 9.27987 1.16438 10.1514 1.75538 10.7428C2.34637 11.3341 3.21788 11.5464 4.01437 11.2933C4.39913 12.0346 5.16488 12.5 6 12.5C6.83512 12.5 7.60087 12.0346 7.98563 11.2933H7.986ZM3.44513 7.26125C3.3075 7.12813 3.25238 6.93125 3.30113 6.74638C3.34988 6.5615 3.49425 6.41675 3.6795 6.36837C3.86475 6.32 4.06125 6.37512 4.19438 6.51312L5.41425 7.73225L8.04788 4.28825C8.22563 4.05575 8.55825 4.0115 8.79037 4.18925C9.0225 4.367 9.06713 4.69963 8.88937 4.93175L6.255 8.37238C6.06975 8.6165 5.78813 8.768 5.4825 8.78863C5.17688 8.80925 4.87725 8.696 4.66125 8.47888L3.44588 7.26125H3.44513Z"{% endcomment %}
                                    {% comment %}fill="#2E2F3C"{% endcomment %}
                                    {% comment %}/>{% endcomment %}
                                    {% comment %}</svg>{% endcomment %}
                                    {% comment %}<span>verified customer</span>{% endcomment %}
                                    {% comment %}</div>{% endcomment %}
                                </div>
                            </customer-review-card>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <script type="quickscript" loading="visibility" src="{{ 'customer-sentiment.js' | asset_url }}"></script>


        {% if ctaBtn %}
            <tracked-button :trackId="{{ ctaTrackId }}" class="btn mx-auto md:w-[458px]"
                            href="{{ ctaBtn.settings.url }}">
                {{ ctaBtn.settings.text }}
            </tracked-button>
        {% endif %}
    </div>

</section>

{% schema %}
{
  "name": "Customer Sentiment",
  "blocks": [
    {
      "type": "review",
      "name": "Review",
      "settings": [
        {
          "id": "title",
          "type": "text",
          "label": "Title"
        },
        {
          "id": "date",
          "type": "text",
          "label": "Date"
        },
        {
          "id": "product",
          "type": "product",
          "label": "Product"
        },
        {
          "id": "content",
          "type": "richtext",
          "label": "Content"
        },
        {
          "id": "photo",
          "type": "image_picker",
          "label": "Photo"
        },
        {
          "id": "author",
          "type": "text",
          "label": "Author"
        }
      ]
    },
    {
      "type": "cta-button",
      "name": "CTA Button",
      "limit": 1,
      "settings": [
        {
          "id": "url",
          "type": "url",
          "label": "Button Url"
        },
        {
          "id": "text",
          "type": "text",
          "label": "Button Text"
        }
      ]
    }
  ],
  "settings": [
    {
      "id": "title",
      "type": "richtext",
      "label": "Title",
      "default": "<p>Why sleepers <i>love</i> Emma</p>"
    },
    {
      "id": "heading_alignment",
      "type": "select",
      "label": "Heading Alignment",
      "options": [
        {
          "value": "start",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "end",
          "label": "Right"
        }
      ],
      "default": "start"
    },
    {
      "type": "text",
      "id": "trackId",
      "label": "Tracking ID"
    },
    {
      "id": "enable_text_clamp",
      "type": "checkbox",
      "label": "Truncate long text?",
      "default": true
    }
  ]
}
{% endschema %}
