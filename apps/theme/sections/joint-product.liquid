<style>
    #product-layout:not(.is-initialized) joint-product-selector {
        display: none;
    }
</style>
<link rel="quickscript" loading="delayed" href="{{ 'joint-product.css' | asset_url }}">

{% liquid

    assign trackId = "Cover_Rotation"
    assign postfix = product.metafields.accentuate.track_postfix

    if postfix != blank
        assign trackId = trackId | append: "_" | append: postfix
    endif
%}

<script id="joint-product-data" type="application/json">
    [
    {% for block in section.blocks %}
        {% assign product = all_products[block.settings.product] %}
        {{ product | json }}
        {% unless forloop.last %},{% endunless %}
    {% endfor %}
    ]
</script>

<script id="joint-product-upsell-data" type="application/json">
    [
    {% for block in section.blocks %}
        {% assign product = all_products[block.settings.upsell] %}
        {{ product | json }}
        {% unless forloop.last %},{% endunless %}
    {% endfor %}
    ]
</script>

<joint-product-engine></joint-product-engine>

<joint-product-selector class="hidden">
    {% for block in section.blocks %}
        {% assign product = block.settings.product %}
        {% assign selected_variant = product.selected_variant %}

        <joint-product-option data-product-id="{{ product.id }}" class="joint-product-option">
            <tracked-button :trackId="{{ trackId }}">
                <div class="flex gap-2 justify-start">
                    <p class="font-semibold">{{ product.metafields.accentuate.display_name | default: product.title }}</p>
                </div>

                <div class="product-price"></div>

                {% if block.settings.show_star_rating %}
                    <joint-product-star-rating
                            :placeholder="{{ product.metafields.accentuate.placeholder_star_rating }}"
                            :productId="{{ product.id }}"
                    ></joint-product-star-rating>
                {% endif %}


                {% if block.settings.short_desc %}
                    <p class="joint-product-option__desc text-comet text-xs md:text-sm">{{ block.settings.short_desc }}</p>
                {% endif %}
            </tracked-button>
        </joint-product-option>
    {% endfor %}
</joint-product-selector>

<script type="quickscript" loading="delayed" src="{{ 'joint-product.js' | asset_url }}"></script>


{% schema %}
{
  "name": "Joint Product",
  "class": "joint-product",
  "blocks": [
    {
      "type": "item",
      "name": "Item",
      "settings": [
        {
          "id": "product",
          "type": "product",
          "label": "Product"
        },
        {
          "id": "upsell",
          "type": "product",
          "label": "Upsell"
        },
        {
          "id": "short_desc",
          "type": "text",
          "label": "Short Description"
        },
        {
          "id": "show_star_rating",
          "type": "checkbox",
          "label": "Show Star Rating",
          "default": false
        }
      ]
    }
  ],
  "settings": [
  ]
}
{% endschema %}

