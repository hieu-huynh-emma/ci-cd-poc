<style>
    .bundle-box {
        display: none;
    }
</style>

<link rel="quickscript" loading="delayed" href="{{ 'bundle-box.css' | asset_url }}" />
{%- assign current_variant = product.selected_or_first_available_variant -%}

{% assign bundle_item_metaobjects = current_variant.metafields.custom.bundle_items.value %}
{% comment %}{% assign configurable_product_handle = product.metafields.accentuate.configurable_product %}{% endcomment %}
{% comment %}{% assign configurable_product = all_products[configurable_product_handle] %}{% endcomment %}

<section id="bundle-box" class="bundle-box">
    <div class="ornament">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 365.882 365.882">
            <g transform="translate(9.5 9.5)">
                <path
                        d="M278.705,200.941H6a12.5,12.5,0,0,1-12.5-12.5V18a12.5,12.5,0,0,1,25,0V175.941H266.205V18a12.5,12.5,0,0,1,25,0V188.441A12.5,12.5,0,0,1,278.705,200.941Z"
                        transform="translate(31.088 155.441)" fill="currentColor" />
                <path
                        d="M3-2H343.882a12.5,12.5,0,0,1,12.5,12.5V95.72a12.5,12.5,0,0,1-12.5,12.5H3A12.5,12.5,0,0,1-9.5,95.72V10.5A12.5,12.5,0,0,1,3-2ZM331.382,23H15.5V83.22H331.382Z"
                        transform="translate(0 77.72)" fill="currentColor" />
                <path d="M18,278.661a12.5,12.5,0,0,1-12.5-12.5V10.5a12.5,12.5,0,0,1,25,0V266.161A12.5,12.5,0,0,1,18,278.661Z"
                      transform="translate(155.441 77.72)" fill="currentColor" />
                <path
                        d="M126.809,100.72H50.11a55.11,55.11,0,0,1,0-110.22c69.107,0,88.178,91.379,88.956,95.269a12.5,12.5,0,0,1-12.257,14.951ZM50.11,15.5a30.11,30.11,0,0,0,0,60.22h60.2C102.9,53.786,84.982,15.5,50.11,15.5Z"
                        transform="translate(46.632 0)" fill="currentColor" />
                <path
                        d="M94.7,100.72H18A12.5,12.5,0,0,1,5.743,85.769C6.521,81.879,25.591-9.5,94.7-9.5a55.11,55.11,0,1,1,0,110.22Zm-60.238-25H94.7a30.11,30.11,0,1,0,0-60.22C59.662,15.5,41.809,53.794,34.461,75.72Z"
                        transform="translate(155.441 0)" fill="currentColor" />
            </g>
        </svg>
        <span>FREE GIFT</span>
    </div>
    {% if section.settings.promotional_text %}
        <div class="saving-text">
            {{ section.settings.promotional_text }}
        </div>
    {% endif %}
    <div class="box-products">
        {% for bundle_item_metaobject in bundle_item_metaobjects %}
            {% assign bundle_item_variant = bundle_item_metaobject.product.value %}
            {% if bundle_item_variant.product.handle != configurable_product_handle %}
                <div class="flex">
                    <div id="product-configuration-{{ bundle_item_variant.product.handle }}"
                         class="product-bundle-item">
                        <div class="quantity-badge">
                            {{ bundle_item_metaobject.qty | default: 1 }}
                        </div>
                        <div class="product-bundle-item__media">
                            {% assign featuredImg = bundle_item_variant.product.featured_image | image_url: width: 120, height: 80 %}
                            {% assign accentuateImg = bundle_item_variant.product.metafields.accentuate.bundle_featured_image[0].src %}

                            <img
                                    src="{{ accentuateImg | default: featuredImg }}"
                                    width="120"
                                    height="80"
                                    alt=""
                                    class="product-bundle-item__image"
                                    loading="lazy"
                            >
                        </div>
                        <div class="product-bundle-item__details">
                            <div class="product__name paragraph-14">
                <span>{% if bundle_item_metaobject.qty > 1 %}{{ bundle_item_metaobject.qty }}x {% endif %}{{
                    bundle_item_variant.product.title }}</span>
                            </div>
                        </div>
                    </div>
                    {% unless forloop.last %}
                        <div class="vertical-line-break">
                            <svg class="promo-plus-sign" xmlns="http://www.w3.org/2000/svg" width="19" height="19"
                                 viewBox="0 0 19 19"
                                 fill="none">
                                <ellipse cx="9.16309" cy="9.13953" rx="9.16309" ry="9.13953" fill="#FFDDB5" />
                                <path
                                        d="M8.4498 12H9.53512V9.87506H11.6601V8.78974H9.53512V6.6648H8.4498V8.78974H6.32486V9.87506H8.4498V12Z"
                                        fill="#F70" />
                            </svg>
                        </div>
                    {% endunless %}
                </div>
            {% endif %}
        {% endfor %}
    </div>

    <div class="box-details">

        <div class="col">
            <p class="font-bold underlined">{{ section.settings.heading }}</p>
            <p class="text-xs text-comet">
                <span>You mattress purchase includes</span>

                {% for bundle_item_metaobject in bundle_item_metaobjects %}
                    {% assign bundle_item_variant = bundle_item_metaobject.product.value %}

                    <span>{{ bundle_item_metaobject.qty | default: 1 }} {{ bundle_item_variant.product.title }}</span>
                    {% unless forloop.last %}<span>, </span>{% endunless %}
                {% endfor %}
            </p>
        </div>
        <div class="col">
            <div class="font-bold uppercase">FREE</div>
            <div class="promo-cta">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="15" height="15">
                    <path fill="#F70"
                          d="M438.6 105.4C451.1 117.9 451.1 138.1 438.6 150.6L182.6 406.6C170.1 419.1 149.9 419.1 137.4 406.6L9.372 278.6C-3.124 266.1-3.124 245.9 9.372 233.4C21.87 220.9 42.13 220.9 54.63 233.4L159.1 338.7L393.4 105.4C405.9 92.88 426.1 92.88 438.6 105.4H438.6z" />
                </svg>
                <span>Included</span>
            </div>
        </div>
    </div>
</section>

{% schema %}
{
  "name": "Bundle Box",
  "class": "hide-until-initialized",
  "settings": [
    {
      "id": "heading",
      "type": "text",
      "label": "Heading",
      "default": "Comfort Sleep Set"
    },
    {
      "id": "promotional_text",
      "type": "text",
      "label": "Promotional Text",
      "default": "455$ in value (Queen Size)"
    }
  ]
}
{% endschema %}
