{% assign current_variant = product.selected_or_first_available_variant %}

{% assign bundle_item_metaobjects = current_variant.metafields.custom.bundle_items.value %}
{% assign configurable_product_handle = product.metafields.accentuate.configurable_product %}

<sticky-buybox>
  <div class="page-boundary">
    <div class="sticky-container">
      <div class="product-info-container">
        <img class="product-image rounded-lg" />
        <h2 class="product-title"></h2>
      </div>
      <div class="buybox-outlet">
        {% render 'proxy-product-options' %}

        {% render 'product-price', variant: current_variant, product: product %}

        {% assign isUnavailable = false %}

        {% if product.selected_or_first_available_variant.available == false %}
          {% assign isUnavailable = true %}
        {% endif %}

        <button
            type="button"
            name="add"
            class="btn btn--block btn--rounded add-to-cart-btn w-full"
            {% if isUnavailable %}disabled{% endif %}
        >
          {% render 'icon-cart-empty' %}

          <span data-add-to-cart-text>
              {%- if isUnavailable -%}
                {{ 'products.product.sold_out' | t }}
              {%- else -%}
                {{ 'products.product.add_to_cart' | t }}
              {%- endif -%}
            </span>
          <div class="loading-overlay__spinner">
            <svg aria-hidden="true" focusable="false" role="presentation" class="spinner" viewBox="0 0 66 66"
                 xmlns="http://www.w3.org/2000/svg">
              <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
            </svg>
          </div>
        </button>


      </div>
      {% if bundle_item_metaobjects %}
        <p class="bundle-box-container text-comet">
          <span>The {{ product.title }} includes our</span>

          {% for bundle_item_metaobject in bundle_item_metaobjects %}
            {% assign bundle_item_variant = bundle_item_metaobject.product.value %}
            <span>
              {% if bundle_item_variant.product.handle != configurable_product_handle %}
                {{ bundle_item_metaobject.qty | default: 1 }}
              {% endif %}
            </span>
            <span> {{ bundle_item_variant.product.title }}
              {% if bundle_item_variant.product.handle == configurable_product_handle %}
                mattress
              {% endif %}
            </span>
              {% unless forloop.last %} {% if forloop.rindex0 == 1 %}and {% else %}
                <span>, </span>{% endif %}{% endunless %}
            {% endfor %}
        </p>
      {% endif %}
    </div>
  </div>
</sticky-buybox>
