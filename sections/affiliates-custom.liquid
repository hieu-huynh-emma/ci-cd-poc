{% assign affiliate_logo = section.settings.affiliate_logo %}
{% assign affiliate_message = section.settings.affiliate_message %}
{% assign url = section.settings.url %}

<style>
    #affiliate-announcement-bar-section a,
    #affiliate-announcement-bar-section div {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: {{section.settings.background_color}};
        padding: 0.5rem;
    }

    #affiliate-announcement-bar-section p {
        color: {{section.settings.text_color}};
        font-size: 11px;
        font-family: "Inter",
        sans-serif;
    }

    #affiliate-announcement-bar-section .affiliate-logo {
        max-height: 1.25rem;
        width: auto;
        max-width: 30%;
        margin-right: 1rem;
    }

    @media (min-width: 768px) {
        #affiliate-announcement-bar-section p {
            font-size: 13px;
        }

        #affiliate-announcement-bar-section .affiliate-logo {
            max-width: auto;
        }
    }

</style>

<script>

    //Clear timer if existed from previous announcement bar
    // clearInterval(timer);

    blockSearchIndexing();
    renderAffiliatesAnnouncementBar();

    function blockSearchIndexing() {
        const meta = document.createElement('meta');
        meta.setAttribute("name", "robots");
        meta.setAttribute("content", "noindex");

        document.getElementsByTagName('head')[0].appendChild(meta);
    }

    function renderAffiliatesAnnouncementBar() {
        const announcementBarId = "shopify-section-sections--16270742552739__announcement-bar"
        document.getElementById(announcementBarId).remove();

        const headerId = "shopify-section-sections--16270742552739__header";
        const header = document.getElementById(headerId);

        const affiliateAnnouncementBarSection = document.createElement("section");
        affiliateAnnouncementBarSection.id = "affiliate-announcement-bar-section";
        affiliateAnnouncementBarSection.innerHTML = '{% if url != blank %}<a href="{{ url }}">{% else %} <div> {% endif %}{% if affiliate_logo != blank %}<img class="affiliate-logo" src="{{ affiliate_logo | img_url: "medium" }}"/>{% endif %}<p>{{ affiliate_message }}</p>{% if url != blank %}</a>{% else %} </div> {% endif %}';

        header.before(affiliateAnnouncementBarSection);
    }

</script>

{% schema %}
{
  "name": "Affiliates custom",
  "settings": [
    {
      "type": "image_picker",
      "id": "affiliate_logo",
      "label": "Affiliate Logo"
    },
    {
      "type": "richtext",
      "id": "affiliate_message",
      "label": "Affiliate Message"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color"
    },
    {
      "type": "url",
      "id": "url",
      "label": "URL"
    }
  ]
}
{% endschema %}
