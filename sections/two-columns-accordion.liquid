{{ 'two-columns-accordion.css' | asset_url | stylesheet_tag }}

{% assign accordionPanelBlocks = section.blocks | where: "type", "accordion_panel" %}

<section id="two-columns-accordion-section">
  <div class="page-boundary">
    <div class="column">
      <h2 class="heading-2">{{ section.settings.left_heading }}</h2>
      <ul class="accordion-panels"></ul>
    </div>
    <div class="column">
      <h2 class="heading-2">{{ section.settings.right_heading }}</h2>
      <ul class="accordion-panels"></ul>
    </div>
  </div>
</section>

<script type="module">


  function renderAccordionPanels() {
    const accordionPanels = [
      {% for block in accordionPanelBlocks %}
      {{ block.settings | json }}
      {%- if forloop.length > 0 -%}
      {% unless forloop.last %},{% endunless -%}
      {%- endif -%}
      {% endfor %}
    ];

    accordionPanels.forEach(renderSinglePanel)
  }

  function renderSinglePanel(panel) {
    const panelElement = $($.parseHTML(`
      <li class="accordion-panel">
        <div class="accordion-panel__header">
          <h3 class="accordion-panel__title">${panel.title}</h3>
          <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="15" cy="15" r="14.5" fill="white" stroke="#3C4196" />
            <path
              d="M10 12.5L15 17.5L20 12.5" stroke="#3C4196" stroke-width="1.5" stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div>
        <div class="accordion-panel__content">
          ${panel.html_content || panel.content}
        </div>
      </li>
      <span class="separator"></span>
    `));

    const $firstCol = $(`#two-columns-accordion-section .column`).first()
    const $secondCol = $firstCol.next()

    const targetCol = panel.position === 'left' ? $firstCol : $secondCol

    targetCol.find('.accordion-panels').append(panelElement)
  }

  $(window).on('load', function () {
    renderAccordionPanels()

    setTimeout(function () {
      $('#two-columns-accordion-section .accordion-panel').beefup({
        trigger: ".accordion-panel__header",
        content: ".accordion-panel__content",
        openSpeed: 500,
        closeSpeed: 250
      });
    }, 0)
  })


</script>

{% schema %}
{
  "name": "Two Columns Accordion",
  "blocks": [
    {
      "type": "accordion_panel",
      "name": "Accordion Panel",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content"
        },
        {
          "type": "html",
          "id": "html_content",
          "label": "HTML Content"
        },
        {
          "type": "select",
          "id": "position",
          "label": "Column Position",
          "options": [
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            }
          ],
          "default": "left"
        }
      ]
    }
  ],
  "settings": [
    {
      "id": "left_heading",
      "type": "text",
      "label": "Left Heading"
    },
    {
      "id": "right_heading",
      "type": "text",
      "label": "Right Heading"
    }
  ]
}
{% endschema %}


