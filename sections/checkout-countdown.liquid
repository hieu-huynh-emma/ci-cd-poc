{% assign countdown_duration = section.settings.countdown_duration %}

<div class="checkout-countdown">
  <div id="checkout-timer"></div>
</div>

<script>
  let end = new Date().setTime(new Date().getTime() + {{ countdown_duration }} * 60 * 1000);
  const timerInterval = setInterval(setTime, 1000);

  $(document).ready(function () {
    if (Shopify.Checkout.step !== "contact_information") {
      stopTimer();
    }
  });

  function setTime() {
    let now = new Date().getTime();
    let diff = end - now;

    var min = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    var sec = Math.floor((diff % (1000 * 60)) / 1000);

    document.getElementById('checkout-timer').innerHTML = `<p>An item in your cart is in high demand. <br/>Your order is reserved for ${min}:${('0' + sec).slice(-2)} minutes. Check out soon!</p>`;

    if (diff < 0) {
      stopTimer();
    }
  }

  function stopTimer() {
    document.getElementsByClassName('checkout-countdown')[0].style.display = 'none';
    clearInterval(myInterval);
  }

</script>

<style>
  #checkout-timer {
    background-color: #FFF6EC;
    border: 1px solid #FFDEB7;
    padding: 20px;
    border-radius: 8px;
    font-weight: 500;
    text-align: center;
    font-size: 12px;
    color: #545454;
  }

  @media (min-width: 1000px) {
    #checkout-timer {
      font-size: 14px;
    }
  }

  .checkout-countdown {
    text-align: center;
    margin-bottom: 30px;
  }

</style>
{% schema %}
{
"name": "Checkout countdown",
"settings": [
{
"type": "number",
"id": "countdown_duration",
"default": 20,
"label": "Countdown duration in minute"
}
]
}
{% endschema %}
