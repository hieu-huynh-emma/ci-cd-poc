{% layout none %}
{%- capture unit_price_separator -%}
<span aria-hidden="true">/</span><span class="visually-hidden">&nbsp;{{ 'general.accessibility.unit_price_separator' | t }}&nbsp;</span>
{%- endcapture -%}
<form action="{{ routes.cart_url }}" method="post" novalidate class="cart ajaxcart">
    <div class="ajaxcart__inner ajaxcart__inner--has-fixed-footer">
    {% for item in cart.items %}
    <div class="ajaxcart__product">
        <div class="ajaxcart__row" data-line="{{forloop.index}}">
        <div class="grid">
            <div class="grid__item one-quarter">
            <a href="{{item.url}}" class="ajaxcart__product-image"><img src="{{item.image | img_url: 'small' | default: '//cdn.shopify.com/s/assets/admin/no-image-medium-cc9732cb976dd349a0df1d39816fbcc7.gif'}}" alt="{{item.product.title}}"></a>
            </div>
            <div class="grid__item three-quarters">
            <div class="ajaxcart__product-name--wrapper">
                <a href="{{item.url}}" class="ajaxcart__product-name">{{item.product.title}}</a>
                {% if item.variant.title %}
                <span class="ajaxcart__product-meta">{{variation}}</span>
                {% endif %}
                {% if item.selling_plan_allocation %}
                <span class="ajaxcart__product-meta">{{item.selling_plan_allocation.selling_plan.name}}</span>
                {% endif %}
                {% for property in item.properties %}
                    <span class="ajaxcart__product-meta">{{ property.first }}: {{ property.last }}</span>
                {% endfor %}
            </div>

            <div class="grid--full">
                <div class="grid__item one-half">
                <div class="ajaxcart__qty">
                    <button type="button" class="ajaxcart__qty-adjust ajaxcart__qty--minus icon-fallback-text" data-id="{{item.key}}" data-qty="{{item.quantity | plus: -1}}" data-line="{{{forloop.index}}" aria-label="{{ 'cart.general.reduce_quantity' | t }}">
                    <span class="icon icon-minus" aria-hidden="true"></span>
                    <span class="fallback-text" aria-hidden="true">&minus;</span>
                    </button>
                    <input type="text" name="updates[]" class="ajaxcart__qty-num" value="{{item.quantity}}" min="0" data-id="{{item.key}}" data-line="{{forloop.index}}" aria-label="quantity" pattern="[0-9]*">
                    <button type="button" class="ajaxcart__qty-adjust ajaxcart__qty--plus icon-fallback-text" data-id="{{item.key}}" data-line="{{forloop.index}}" data-qty="{{item.quantity | plus: 1}}" aria-label="{{ 'cart.general.increase_quantity' | t }}">
                    <span class="icon icon-plus" aria-hidden="true"></span>
                    <span class="fallback-text" aria-hidden="true">+</span>
                    </button>
                </div>
                </div>
                <div class="grid__item one-half text-right">
                {% if item.line_level_discount_allocations.size > 0 %}
                    <span class="visually-hidden">{{ 'products.general.regular_price' | t }}</span>
                    <del class="ajaxcart__price">{{{price}}}</del>
                    <span class="visually-hidden">{{ 'products.general.sale_price' | t }}</span>
                    <span class="ajaxcart__price">{{{discountedPrice}}}</span>
                {% else %}
                    <span class="ajaxcart__price">{{item.variant.compare_at_price}}</span>
                    <span class="ajaxcart__price">{{item.price}}</span>
                {% endif %}
                {% if item.unit_price_measurement %}
                    <span class="visually-hidden">{{ 'products.general.unit_price' | t }}</span>
                    <span class="cart__unit-price">
                    <span>{{{ item.unit_price }}}</span>{{- unit_price_separator -}}{% if item.unit_price_measurement.reference_value != 1 %}{{ item.unit_price_measurement.reference_value }}{% endif %}{{ item.unit_price_measurement.reference_unit }}
                    </span>
                {% endif %}
                </div>
            </div>
            {% if item.line_level_discount_allocations.size > 0 %}
                <div class="grid--full">
                <div class="grid__item text-right">
                    <ul class="order-discount order-discount--list order-discount--title order-discount--ajax-cart order-discount--ajax-cart-list" aria-label="{{ 'customer.order.discount' | t }}">
                    {% for discount in item.line_level_discount_allocations %}
                        <li class="order-discount__item">
                        <span class="icon icon-saletag" aria-hidden="true"></span>{{ discount.discount_application.title }} (-{{ discount.amount }})
                        </li>
                    {% endfor %}
                    </ul>
                </div>
                </div>
            {% endif %}
            </div>
        </div>
        </div>
    </div>
    {% endfor %}

    {% if settings.cart_notes_enable %}
        <div>
        <label for="CartSpecialInstructions" class="ajaxcart__note">{{ 'cart.general.note' | t }}</label>
        <textarea name="note" class="input-full" id="CartSpecialInstructions">{{cart.note}}</textarea>
        </div>
    {% endif %}
    <div class="cart_upsell"> {% render 'cart_upsell' %}  </div>
    </div>
    <div class="ajaxcart__footer ajaxcart__footer--fixed">
    <div class="grid--full">
        {% if cart.cart_level_discount_applications.size > 0 %}
        {% for discount in cart.cart_level_discount_applications %}
            <div class="grid__item two-thirds ajaxcart__discounts">
            <span class="order-discount order-discount--title order-discount--ajax-cart">
                <span class="icon icon-saletag" aria-hidden="true"></span><span class="visually-hidden">{{ 'customer.order.discount' | t }}:</span>{{ this.title }}
            </span>
            </div>
            <div class="grid__item one-third text-right">
            <span class="ajaxcart__price">-{{{ discount.amount }}}</span>
            </div>
        {% endfor %}
        {% endif %}
        <div class="grid__item two-thirds">
        <p class="ajaxcart__subtotal">{{ 'cart.general.subtotal' | t }}</p>
        </div>
        <div class="grid__item one-third text-right">
        <p class="ajaxcart__subtotal">{{cart.total_price}}</p>
        </div>
    </div>

    <p class="ajaxcart__policies">
        {%- capture taxes_shipping_checkout -%}
        {%- if cart.taxes_included and shop.shipping_policy.body != blank -%}
            {{ 'cart.general.taxes_included_and_shipping_policy_html' | t: link: shop.shipping_policy.url }}
        {%- elsif cart.taxes_included -%}
            {{ 'cart.general.taxes_included_but_shipping_at_checkout' | t }}
        {%- elsif shop.shipping_policy.body != blank -%}
            {{ 'cart.general.taxes_and_shipping_policy_at_checkout_html' | t: link: shop.shipping_policy.url }}
        {%- else -%}
            {{ 'cart.general.taxes_and_shipping_at_checkout' | t }}
        {%- endif -%}
        {%- endcapture -%}
        {{ 'cart.general.free_shipping_and_taxes_at_checkout' | t }}
    </p>
    <button type="submit" class="btn--secondary btn--full cart__checkout" name="checkout">
        {{ 'cart.general.checkout' | t }} </span>
    </button>
    <a href="\cart" class="btn--secondary btn--full marztop">
    {{ 'cart.general.view_my_card' | t }}</span>
    </a>
    </div>
</form>